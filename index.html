<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ติดตาม Top-up</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* New September Palette: Forest Green, Teal, Mustard Gold */
        :root {
            --color-primary-dark: #004D40; /* Forest Green (Text, Main Accent) */
            --color-secondary-teal: #00897B; /* Teal (Buttons, Action) */
            --color-highlight-gold: #FFC107; /* Mustard Gold (Icons, Warning Accent) */
            --color-light-teal: #B2DFDB; /* Light Teal (Dividers, Footer, Table Header) */
            --color-background-light: #FAFAFA; /* Off-White Background */
            --color-info-bg: #E0F2F1; /* Very Light Teal/Mint (Info Boxes) */
        }

        /* General Styles */
        body {
            font-family: 'Chakra Petch', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--color-background-light);
            color: #333333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1000px;
            margin: 30px auto;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            flex-grow: 1;
        }

        /* Header Styles */
        header {
            background: #ffffff;
            color: var(--color-primary-dark);
            padding: 25px 20px 35px;
            text-align: center;
            border-radius: 16px 16px 0 0;
            border-bottom: 3px solid var(--color-light-teal); /* Light Teal border */
        }

        header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 700;
            letter-spacing: 0.8px;
            color: var(--color-primary-dark);
        }
        header h1 .fas {
            margin-right: 12px;
            color: var(--color-highlight-gold); /* Mustard Gold accent for icon */
        }

        /* Section Styles */
        section {
            margin-bottom: 35px;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 20px;
            border: 1px solid #F5F5F5;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        section h2 {
            color: var(--color-primary-dark); /* Forest Green for section titles */
            margin-top: 0;
            padding-bottom: 18px;
            border-bottom: 3px solid var(--color-light-teal); /* Light Teal border */
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 25px;
        }
        section h2 .fas {
            margin-right: 12px;
            color: var(--color-highlight-gold); /* Mustard Gold accent for icon */
        }

        /* Button Styles */
        .button-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-secondary-teal); /* Teal */
            color: #ffffff;
            padding: 16px 35px;
            text-decoration: none;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: 600;
            transition: all 0.3s ease-in-out;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        .button .fas {
            margin-right: 10px;
            font-size: 1.1em;
        }
        .button:hover {
            background-color: #00695C; /* Darker Teal on hover */
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        .button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* Specific Button Colors */
        .button-er {
            background-color: var(--color-secondary-teal); /* Teal for ER */
            color: #ffffff;
        }
        .button-er:hover {
            background-color: #00695C;
        }
        .button-patho {
            background-color: #4CAF50; /* Slightly different Green for Patho */
            color: #ffffff;
        }
        .button-patho:hover {
            background-color: #388E3C;
        }

        /* Tab Content */
        .tab-content {
            padding: 0;
            border: none;
            background-color: transparent;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-content h3 {
            margin-top: 0;
            color: var(--color-secondary-teal); /* Teal for sub-headings */
            font-size: 1.6em;
            margin-bottom: 20px;
        }

        /* Schedule Display Styles */
        .schedule-display {
            padding: 15px;
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid var(--color-light-teal);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .search-input {
            width: calc(100% - 20px);
            padding: 12px 10px;
            margin-bottom: 20px;
            border: 2px solid var(--color-light-teal); /* Light Teal border */
            border-radius: 8px;
            font-size: 1.1em;
            font-family: 'Chakra Petch', sans-serif;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s ease;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--color-secondary-teal); /* Teal on focus */
        }

        .table-container {
            max-height: 600px;
            overflow-y: auto;
            overflow-x: auto;
            border: 1px solid var(--color-light-teal);
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
            table-layout: auto;
        }

        .schedule-table th, .schedule-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #F5F5F5;
            white-space: normal;
            vertical-align: top;
        }

        .schedule-table th {
            background-color: var(--color-light-teal); /* Light Teal for header */
            color: var(--color-primary-dark); /* Forest Green for header text */
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .schedule-table tbody tr:nth-child(even) {
            background-color: var(--color-info-bg); /* Very Light Teal/Mint Alternate row color */
        }

        .schedule-table tbody tr:hover {
            background-color: #B2DFDB; /* Light Teal on hover */
        }

        .loading-indicator {
            text-align: center;
            padding: 30px;
            color: var(--color-secondary-teal); /* Teal */
            font-size: 1.2em;
        }
        .loading-indicator .fas {
            margin-right: 10px;
        }

        /* Instruction & Tracking Info Styles */
        .instruction {
            font-size: 1em;
            color: #555;
            background-color: var(--color-info-bg); /* Very Light Teal/Mint info box */
            padding: 18px 25px;
            border-left: 8px solid var(--color-light-teal); /* Light Teal border */
            margin-bottom: 30px;
            border-radius: 10px;
            line-height: 1.6;
        }
        .instruction .fas {
            margin-right: 12px;
            color: var(--color-light-teal);
        }
        .instruction.warning {
            background-color: #FFFDE7; /* Very light yellow warning */
            border-left-color: var(--color-highlight-gold); /* Mustard Gold warning border */
            color: #616161; /* Darker text */
        }
        .instruction.warning .fas {
            color: var(--color-highlight-gold); /* Mustard Gold warning icon color */
        }

        .tracking-info ul {
            list-style-type: none;
            padding-left: 0;
        }
        .tracking-info li {
            margin-bottom: 15px;
            background-color: var(--color-info-bg); /* Very Light Teal/Mint background */
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid var(--color-light-teal);
            transition: background-color 0.2s ease;
        }
        .tracking-info li:hover {
            background-color: #B2DFDB; /* Subtle Light Teal hover effect */
        }
        .tracking-info li a {
            text-decoration: none;
            color: var(--color-primary-dark); /* Forest Green for link */
            font-weight: 600;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
        }
        .tracking-info li a:hover {
            color: var(--color-secondary-teal); /* Teal on hover */
            text-decoration: underline;
        }
        .tracking-info li a .fas {
            margin-right: 10px;
            font-size: 1.2em;
            color: var(--color-highlight-gold); /* Mustard Gold for icon */
        }
        .tracking-info small.instruction {
            margin-top: 10px;
            font-size: 0.85em;
            background-color: var(--color-info-bg);
            border-left-color: var(--color-highlight-gold); /* Mustard Gold for specific instruction */
            color: #666;
            padding: 10px 15px;
            border-radius: 8px;
        }
        .tracking-info small.instruction .fas {
            color: var(--color-highlight-gold); /* Mustard Gold for specific instruction icon */
        }

        /* Footer Styles */
        footer {
            text-align: center;
            padding: 30px;
            background-color: var(--color-light-teal); /* Light Teal footer background */
            color: var(--color-primary-dark); /* Forest Green text */
            margin-top: auto;
            border-top: 2px solid #F5F5F5;
            font-size: 1em;
        }
        footer p {
            margin: 0;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
                margin: 20px auto;
            }
            header h1 {
                font-size: 2.2em;
            }
            section {
                padding: 25px;
                margin-bottom: 30px;
            }
            section h2 {
                font-size: 1.8em;
            }
            .button-container {
                flex-direction: row;
                justify-content: center;
                gap: 15px;
            }
            .button {
                flex: 1 1 auto;
                max-width: 180px;
                padding: 12px 20px;
                font-size: 1.1em;
            }
            .schedule-table {
                font-size: 0.9em;
            }
            .schedule-table th, .schedule-table td {
                padding: 10px;
            }
            .instruction {
                padding: 15px 20px;
            }
        }
        @media (max-width: 480px) {
            header h1 {
                font-size: 1.8em;
            }
            section h2 {
                font-size: 1.6em;
            }
            .button {
                max-width: 150px;
                padding: 10px 15px;
                font-size: 1em;
            }
            .schedule-table {
                font-size: 0.85em;
            }
            .schedule-table th, .schedule-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-cash-register"></i> ระบบติดตาม Top-up Staff & Intern</h1>
        </header>

        <main>
            <section class="quick-links">
                <h2><i class="fas fa-external-link-alt"></i> จ่ายเงิน Top-up </h2>
                <div class="button-container">
                    <a href="https://forms.gle/rvx5QGJjhBPaAaoKA" target="_blank" class="button button-er">
                        <i class="fas fa-first-aid"></i> Top up ER
                    </a>
                    <a href="https://forms.gle/fRrUjdr8Px5kvCcy5" target="_blank" class="button button-patho">
                        <i class="fas fa-microscope"></i> Top up ชันสูตร
                    </a>
                </div>
            </section>

            <section class="intern-info">
                <h2><i class="fas fa-clock"></i> ตารางเวรกันยายน </h2>
                <div id="schedule" class="tab-content" style="display: block;">
                    <div class="schedule-display">
                        <p class="instruction"><i class="fas fa-info-circle"></i> ตารางเวรแบ่งตามเวรเช้าบ่ายดึก ER จ่ายตามเวร ชันสูตรจ่ายตามวัน</p>
                        <p class="instruction warning"><i class="fas fa-exclamation-triangle"></i> <strong>ขอความร่วมมือจ่ายก่อนวันที่ 5 ของเดือนถัดไป</strong></p>
                        <input type="text" id="scheduleSearch" placeholder="ค้นหารายชื่อตามตารางเวรได้ที่นี่" class="search-input">
                        <div id="scheduleTableContainer" class="table-container">
                            <div class="loading-indicator">
                                <i class="fas fa-spinner fa-spin"></i> กำลังโหลดตารางเวร...
                            </div>
                            </div>
                    </div>
                </div>
            </section>

            <section class="tracking-info">
                <h2><i class="fas fa-chart-line"></i> ติดตามการจ่ายและรับเงิน</h2>
                <p class="instruction"><i class="fas fa-info-circle"></i> สามารถตรวจสอบยอดเงินที่จ่ายและรับได้จาก Google Sheets โดยตรงผ่านลิงก์ด้านล่าง:</p>
                <ul>
                    <li>
                        <a href="https://docs.google.com/spreadsheets/d/1z2mUc-34r-6Kpnqptf7loIRDUtQZXuVkaN4-m9_xDzw/edit?usp=sharing"_blank">
                           <i class="fas fa-chart-pie"></i> ตรวจสอบยอดการจ่ายและรับเงินทั้งหมด (Google Sheets) </a>
                    </li>
                </ul>
            </section>
        </main>
    </div>

    <footer>
        <p>&copy; <span id="currentYear"></span> Top-up Tracking Dashboard | ออกแบบและพัฒนาเพื่อความสะดวกในการติดตามข้อมูล</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Set current year in footer
            document.getElementById("currentYear").textContent = new Date().getFullYear();

            // --- Schedule Table Functionality ---
            const scheduleTableContainer = document.getElementById('scheduleTableContainer');
            const scheduleSearchInput = document.getElementById('scheduleSearch');
            const loadingIndicator = scheduleTableContainer.querySelector('.loading-indicator');

            // IMPORTANT: Replace this URL with your Google Sheet's published CSV URL.
            // How to get this URL:
            // 1. Open your Google Sheet.
            // 2. Go to File > Share > Publish to web.
            // 3. Under "Link", choose "Comma-separated values (.csv)" for the sheet you want to embed (e.g., "Sheet1").
            // 4. Copy the generated URL. It should look something like:
            //    https://docs.google.com/spreadsheets/d/e/2PACX-1vR4exU8gkYDVGqBoa2u04E8a6BX5XSrKBnuPvDDrIISzg9VihppbFyNr-i_0I8NbaiFzXYe3otg1zTN/pub?gid=734674429&single=true&output=csv
            const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR4exU8gkYDVGqBoa2u04E8a6BX5XSrKBnuPvDDrIISzg9VihppbFyNr-i_0I8NbaiFzXYe3otg1zTN/pub?gid=734674429&single=true&output=csv';

            let allScheduleData = []; // To store all data for filtering

            // Function to parse CSV data
            function parseCSV(csvText) {
                const lines = csvText.split('\n').filter(line => line.trim() !== ''); // Filter out empty lines
                if (lines.length === 0) return { headers: [], data: [] };

                const headers = lines[0].split(',').map(header => header.trim());
                const data = lines.slice(1).map(line => {
                    // Simple split by comma, might need more robust CSV parser for complex cases
                    return line.split(',').map(cell => cell.trim());
                });
                return { headers, data };
            }

            // Function to render the table
            function renderTable(dataToRender) {
                let tableHTML = '<table class="schedule-table"><thead><tr>';
                // Create table headers
                allScheduleData.headers.forEach(header => {
                    tableHTML += `<th>${header}</th>`;
                });
                tableHTML += '</tr></thead><tbody>';

                // Create table rows
                dataToRender.forEach(row => {
                    tableHTML += '<tr>';
                    row.forEach(cell => {
                        tableHTML += `<td>${cell}</td>`;
                    });
                    tableHTML += '</tr>';
                });
                tableHTML += '</tbody></table>';
                scheduleTableContainer.innerHTML = tableHTML;
            }

            // Function to filter table rows based on search input
            function filterTable() {
                const searchTerm = scheduleSearchInput.value.toLowerCase();
                const filteredData = allScheduleData.data.filter(row => {
                    // Check if any cell in the row contains the search term
                    return row.some(cell => cell.toLowerCase().includes(searchTerm));
                });
                renderTable(filteredData);
            }

            // Fetch data when the page loads
            fetch(GOOGLE_SHEET_CSV_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(csvText => {
                    loadingIndicator.style.display = 'none'; // Hide loading indicator
                    allScheduleData = parseCSV(csvText);
                    if (allScheduleData.data.length > 0) {
                        renderTable(allScheduleData.data);
                        scheduleSearchInput.addEventListener('input', filterTable); // Add search listener
                    } else {
                        scheduleTableContainer.innerHTML = '<p class="instruction warning"><i class="fas fa-exclamation-circle"></i> ไม่พบข้อมูลตารางเวร หรือตารางเวรว่างเปล่า</p>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching or parsing Google Sheet data:', error);
                    loadingIndicator.style.display = 'none'; // Hide loading indicator
                    scheduleTableContainer.innerHTML = '<p class="instruction warning"><i class="fas fa-exclamation-circle"></i> ไม่สามารถโหลดตารางเวรได้ กรุณาลองใหม่อีกครั้ง หรือตรวจสอบลิงก์</p>';
                });
        });
    </script>
</body>
</html>
